{% extends 'main.html' %} {% load static %} {% block content %}

<main class="layout layout">
    <div class="container">
        <div class="row">
            <div class="col-sm-6 img-circle">
                <img src="{% static 'images/ad1.jpg' %}" style="width: 300px; height:auto"
                    id="ad1" data-cost="10" onclick="sendAdClick(this)">
            </div>
            <div class="col-sm-6">
                <p id="ad1-count"></p>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 img-circle">
                <img src="{% static 'images/ad2.jpg' %}" style="width: 300px; height:auto"
                    id="ad2" data-cost="20" onclick="sendAdClick(this)">
            </div>
            <div class="col-sm-6">
                <p id="ad2-count">Test paragraph</p>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 img-circle">
                <img src="{% static 'images/ad3.jpg' %}" style="width: 300px; height:auto"
                    id="ad3" data-cost="30" onclick="sendAdClick(this)">
            </div>
            <div class="col-sm-6">
                <p id="ad3-count">Test paragraph</p>
            </div>
        </div>
    </div>
</main>

<script>
    //let csrftoken = $("[name=csrfmiddlewaretoken]").val();
    setInterval(requestCount, 2000);

    function sendAdClick(elem) {
        var ad = new Object();
        ad.adId = elem.getAttribute("id");
        ad.adCost = parseInt(elem.getAttribute("data-cost"));
        ad.csrfmiddlewaretoken = '{{ csrf_token }}';
        $.ajax({
            "url": '/home/recordClick',
            "type": 'POST',
            "data": ad,
            {% comment %} "success": function(data) {
                alert(data.status)
                //document.getElementById("str1").innerHTML = data.status;
            } {% endcomment %}
            //'csrfmiddlewaretoken': '{{ csrf_token }}'
        })
        //$.post("home", ad)
    }

    function requestCount() {
        $.get("home/getCounts", function(data, status) {
            if (status == "success") {
                $.each(data.df, function(i, row) {
                    document.getElementById(row.asset + "-count").innerHTML = row.count;
                });
            } else {
                console.log("GET request failed with status: " + status);
            }
        });
    }

    {% comment %} $(document).ready(function() {
        $("#ad1").click(function() {
            $.post("home", {
                ID: "1",
                cost: "10",
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            });
        });
    });

    $(document).ready(function() {
        $("#ad2").click(function() {
            $.post("home", {
                ID: "2",
                cost: "100",
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            });
        });
    });

    $(document).ready(function() {
        $("#ad3").click(function() {
            $.post("home", {
                ID: "3",
                cost: "1000",
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            });
        });
    }); {% endcomment %}
</script>

{% endblock %}